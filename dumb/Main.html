{{ block content }}
<header class="bg-light">
    <p class="border p-1">Minimalistic page to test features</p>
    <ot-progress ticks="1" max="100" val="vars.counter" val2="vars.counter2"></ot-progress>
</header>

<main ot-fade>
    <div ot-switch class="border p-3">
        <div hidden ot-switched id="div-1" class="fs-1 text-center">one</div>
        <div hidden ot-switched id="div-2" class="fs-1 text-center">two</div>
        <div hidden ot-switched id="div-3" class="fs-1 text-center">three</div>
    </div>
</main>

<footer class="bg-light">
    <p class="border p-1">Press some keys to toggle something</p>
    <div>
        <kbd ot-key-input="1" name="switch" value="1">1</kbd>
        <kbd ot-key-input="2" name="switch" value="2">2</kbd>
        <kbd ot-key-input="3" name="switch" value="3">3</kbd>
    </div>
    <ot-progress class="timer m-3" max="3000" val="vars.timer"></ot-progress>
    <div class="flex-fill"></div>
    <ot-pulse id="pulse"></ot-pulse>
</footer>

{{ endblock }}

{{ block styles }}
<link rel="stylesheet" href="{{ static 'fullscreen.css' }}">
<link rel="stylesheet" href="{{ static 'otree-front-ext.css' }}">
<link rel="stylesheet" href="{{ static 'ot-progress.css' }}">
<style>
.timer {
    --ot-progress-animation-time: 1000ms;
    --ot-progress-animation-style: linear;
}
</style>
{{ endblock }}

{{ block scripts }}
<script src="{{ static 'otree-front-2.0.b1.js' }}"></script>
<script src="{{ static 'otree-front-ext.js' }}"></script>
<script src="{{ static 'ot-progress.js' }}"></script>

<script>
    "use strict";

    const FADEOUT_TIME = parseInt(getStyleProp("--ot-fade-out-time"));

    ot.onEvent('loaded', startPage);
    ot.onEvent('input', 'switch', onInput(switchSection));
    ot.onEvent('timer', 'timebar', onTimer(timeBar));
    ot.onEvent('timer', 'timeout', onTimer(timeOut));

    function startPage() {
        vars.visible = true;
        vars.counter = 0;
        vars.counter2 = 0;
        fadeOff();
        nextIter();
    }

    function switchSection(name, value) {
        ot.switchDisplays(`div-${value}`);
    }

    function nextIter() {
        fadeIn();
        vars.counter2 += 1;
        ot.startTimerPeriodic('timebar', 1000);
        ot.startTimer('timeout', 3000);
    }

    async function timeBar(name, elapsed, count) {
        if (count == 0) {
            vars.timer = null;
            await ot.delay(15); // time for progress bar to reset
        }
        vars.timer = (count + 1) * 1000; // align to steps for smooth animation
    }

    async function timeOut() {
        vars.counter += 1;
        ot.showDisplays('pulse');
        await ot.delay(1000);
        ot.hideDisplays('pulse');
        fadeOut();
        await ot.delay(FADEOUT_TIME);
        nextIter();
    }

</script>
{{ endblock }}
