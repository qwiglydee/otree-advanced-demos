{{ block title }}
Voting
{{ endblock }}

{{ block styles }}
<link href="{{ static 'fullscreen.css' }}" rel="stylesheet">
<link href="{{ static 'enhancements.css' }}" rel="stylesheet">
{{ endblock }}

{{ block content }}

<header>
    <h4>Group votes:</h4>
    <ul class="votes">
        {{ for p in group.get_players }}
        <li>{{p.name}}: <span ot-text="vars.votes.{{p.id}}"></span></li>
        {{ endfor }}
    </ul>
</header>

<main>
    <div class="chat w-50 m-3 border-light">
        <!-- otree-front is limited to fixed structure of html -->
        <div class="message h-1 m-1" ot-html="vars.chat.0"></div>
        <div class="message h-1 m-1" ot-html="vars.chat.1"></div>
        <div class="message h-1 m-1" ot-html="vars.chat.2"></div>
        <div class="message h-1 m-1" ot-html="vars.chat.3"></div>
        <div class="message h-1 m-1" ot-html="vars.chat.4"></div>
        <div class="message h-1 m-1" ot-html="vars.chat.5"></div>
        <div class="message h-1 m-1" ot-html="vars.chat.6"></div>
        <div class="message h-1 m-1" ot-html="vars.chat.7"></div>
        <div class="message h-1 m-1" ot-html="vars.chat.8"></div>
        <div class="message h-1 m-1" ot-html="vars.chat.9"></div>
        <div class="input-group m-3">
            <input type="text" class="form-control" ot-input name="message" ot-kbd="Enter" autofocus
            placeholder="type a message to send to chat">
        </div>
    </div>
</main>

<footer class="f-row">
    <h4>Your vote:</h4>
    {{ for i, option in options }}
    <div class="form-check m-3 p-3 bg-light border-dark">
        <input id="choice.{{i}}" class="form-check-input" type="radio" ot-input name="vote" value="{{option}}">
        <label for="choice.{{i}}" class="form-check-label">{{option}}</label>
    </div>
    {{ endfor }}
</footer>

{{ endblock }}


{{ block scripts }}

<script src="{{ static 'otree-front-1.3.b1.js' }}"></script>

<script>
    const CHAT_SIZE = 10;

    ot.onStartPage(function () {
        ot.enableInputs();
        vars.chat = [];
        vars.votes = {};
    });

    ot.onInput('message', function (text) {
        ot.sendLive('message', { text });
        ot.resetInput('message', "");
    });

    ot.onLive('message', function (data) {
        vars.chat.push(`<b>${data.player}:</b> ${data.text}`);
        vars.chat = vars.chat.splice(-CHAT_SIZE);
    });

    ot.onInput('vote', function (value) {
        console.debug("vote:", value);
        ot.sendLive('vote', { vote: value });
    });

    ot.onLive('votes', function (data) {
        vars.votes = data;
    });

    ot.onLive('complete', function() {
        ot.completePage()
    });

    ot.onLive('failure', function (message) {
        alert(message);
        ot.completePage();
    });
</script>

{{ endblock }}