{{ block content }}

<header>
    <my-progress max="vars.progress.total" ticks="1" value="vars.progress.solved"></my-progress>
    <div class="alert alert-info m-2">Total score: <b ot-text="vars.progress.score"></b></div>
</header>

<main>
    {{ for slider in sliders }}
    <input type="range" min="-10" max="10" step="1" class="form-range slider" ot-class="vars.styles.{{slider.id}}"
        style="margin-left:{{slider.offset.L}}px; margin-right:{{slider.offset.R}}px" ot-input
        name="slider_{{slider.id}}">
    {{ endfor }}
</main>

<footer>
    <p>Put all sliders into middle position.</p>
</footer>

{{ endblock }}

{{ block styles }}
<link rel="stylesheet" href="{{ static 'fullscreen.css' }}">
<link rel="stylesheet" href="{{ static 'progress2.css' }}">
<style>
    .otree-body {
        border: 1px solid #dee2e6;
        border-radius: .25rem;
    }

    main {
        flex-flow: row wrap;
        align-content: flex-start;
        gap: 1rem;
    }

    input.slider {
        width: 300px;
        height: 30px;
        border-radius: 15px;
        padding: 0 7.5px;
        background: hsl(216, 17%, 98%);
        border: 1px solid rgba(0, 0, 0, 0.125);
    }

    input.slider.is-valid {
        background: hsl(151.2, 71.43%, 93.14%);
    }
</style>
{{ endblock }}

{{ block scripts }}
<script src="{{ static 'otree-front-1.5.b2.js' }}"></script>
<script src="{{ static 'progress2.js' }}"></script>
<script src="{{ static 'format_score.js' }}"></script>
<script>
    "use strict";
    ot.onStartPage(initPage);
    ot.onLive('sliders', resetSliders);
    ot.onLive('progress', updateProgress);
    ot.onInput(inputSlider);
    ot.onLive('feedback', receiveFeedback);
    ot.onLive('failure', function (message) { alert(message); ot.completePage(); });


    function initPage() {
        vars.styles = {};
        ot.disableInputs();
        ot.sendLive('start');
    };

    function updateProgress(progress) {
        vars.progress = progress;
        if (progress.terminated) {
            ot.delay(1000, ot.completePage);
        }
    };

    function highlightClass(solved) {
        return solved ? "is-valid" : null;
    }

    function resetSliders(data) {
        data.sliders.forEach(slider => {
            ot.resetInput(`slider_${slider.id}`, slider.value);
            vars.styles[slider.id] = highlightClass(slider.solved);
        });
        ot.enableInputs();
    };

    function inputSlider(name, value) {
        let id = name.split('_')[1]
        value = parseInt(value);
        ot.sendLive("slider", { id, value });
    };

    function receiveFeedback(feedback) {
        vars.styles[feedback.slider] = highlightClass(feedback.solved);
    };
</script>
{{ endblock }}