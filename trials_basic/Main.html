{{ block title }}
Main page
{{ endblock }}

{{ block content }}

<header>
    <h3>Trial <span ot-text="progress.current"></span> / <span ot-text="progress.total"></span></h3>
</header>

<main ot-class="main_visible">
    <div class="task" ot-text="trial.question"></div>

    <div class="input-group">
        <input type="number" class="form-control" ot-input="answer" autofocus>
    </div>
</main>

<footer>
    <div>Type solution to the equation and press <kbd>Enter</kbd></div>
</footer>

<!-- form fields to submit to server -->
<input type="hidden" name="answers" ot-attr-value="form.answers">
<input type="hidden" name="total_time" ot-attr-value="form.total_time">

{{ endblock }}

{{ block styles }}
<link rel="stylesheet" href="{{ static 'fullscreen.css' }}">
<link rel="stylesheet" href="{{ static 'common.css' }}">
{{ endblock }}

{{ block scripts }}
<script src="{{ static 'otree-front-1.0.0.js' }}"></script>

<script>
    "use strict";

    const TRIALS = js_vars.trials;
    const NUM_TRIALS = TRIALS.length;

    ot.onLoad(function () {
        ot.page.form = { answers: "", total_time: 0 }
        ot.page.progress = { total: NUM_TRIALS, current: 0 };
        ot.beginMeasurement();
        ot.startIteration();
    });

    ot.onIteration(function () {
        delete ot.page.trial;
        delete ot.page.response;

        ot.freezeInputs();
        ot.page.progress.current += 1;
        if (ot.page.progress.current > NUM_TRIALS) {
            ot.completePage();
        } else {
            let trial = TRIALS[ot.page.progress.current - 1];
            ot.startTrial(trial);
        }
    });

    ot.onTrial(function (trial) {
        console.debug("trial", trial);
        ot.page.trial = trial;
        ot.page.main_visible = "show";
        ot.resetInputs();
    });

    ot.onInput('answer', function (value) {
        ot.freezeInputs();
        ot.page.response = parseInt(value.trim()); // convert raw text value to number  
        console.debug("response", ot.page.response);
        ot.completeTrial({});
    });

    ot.onComplete(function () {
        ot.page.form.answers += ot.page.response + ";"; // save semicolon-separated values
        if (ot.page.progress.current == NUM_TRIALS) {
            ot.page.form.answers = ot.page.form.answers.slice(0, -1); // cut of trailing semicolon
            ot.page.form.total_time = ot.endMeasurement();
        }

        ot.page.main_visible = "hide";
        ot.delay(100, ot.nextIteration); // delay for animation of main hiding
    });

</script>

{{ endblock }}